AmCharts.loadJSON=function(url,method){try{return JSON.parse($.ajax({type:method,url:url,async:!1,cache:!1,dataType:"json"}).responseText)}catch(err){console.log("Error: "+err)}},$.loadChart=function(div,url,type,mes,method){var div="undefined"!=typeof div?div:"#chartdiv",type="undefined"!=typeof type&&0!=type.length?"/"+type:"",mes="undefined"!=typeof mes&&0!=mes.length?"/"+mes:"",method="undefined"!=typeof method?method:"POST",url="undefined"!=typeof url?url+type+mes:"";try{var data=AmCharts.loadJSON(url,method);AmCharts.ready(function(){AmCharts.makeChart(div,data)})}catch(err){console.log("Error: "+err)}},$.graficoBroken=function(div,url,method){var chart,selected,types=AmCharts.loadJSON(url,method);AmCharts.ready(function(){chart=new AmCharts.AmPieChart;var legend=new AmCharts.AmLegend;legend.valueText="",chart.addLegend(legend,"legenddiv");var exportConfig={menuTop:"30px",menuBottom:"auto",menuRight:"70px",backgroundColor:"#efefef",menuItems:[{textAlign:"center",icon:"http://www.amcharts.com/lib/3/images/export.png",title:"Bajar",items:[{title:"JPG",format:"jpg"},{title:"PNG",format:"png"},{title:"SVG",format:"svg"},{title:"PDF",format:"pdf"}]}]};chart.dataProvider=$.generateChartData(types,selected),chart.titleField="type",chart.valueField="percent",chart.outlineColor="#FFFFFF",chart.outlineAlpha=.8,chart.outlineThickness=2,chart.colorField="color",chart.pulledField="pulled",chart.balloonText="<b>$[[percent]] ([[percents]]%)</b>",chart.labelText="[[type]]",chart.radius="30%",chart.exportConfig=exportConfig,chart.addTitle("ENERO"),chart.addListener("clickSlice",function(event){void 0!=event.dataItem.dataContext.id?(selected=event.dataItem.dataContext.id,alert("clickSlice ON")):(selected=void 0,alert("clickSlice OFF")),chart.dataProvider=$.generateChartData(types,selected),chart.validateData()}),legend.removeListener(chart,"clickMarker"),chart.write(div)})},$.generateChartData=function(types,selected){for(var chartData=[],i=0;i<types.length;i++)if(i==selected)for(var x=0;x<types[i].subs.length;x++)chartData.push({type:types[i].subs[x].type,percent:types[i].subs[x].percent,pulled:!0});else chartData.push({type:types[i].type,percent:types[i].percent,id:i});return chartData};